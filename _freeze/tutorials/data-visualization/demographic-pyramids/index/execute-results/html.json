{
  "hash": "bf4777845ec2670557ecea6df6a0dbbf",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Demographic Pyramids in R\"\nsubtitle: \"Visualizing Population Age and Gender Structure\"\ndescription: \"Learn how to create demographic pyramids using ggplot2 to visualize population structure, providing insights into demographic trends and patterns.\"\nauthor: \"EKIO Academy Team\"\ndate: \"2024-01-20\"\ncategories: [data-visualization, ggplot2, demographics, brazilian-data]\nimage: \"../../../static/images/thumbnails/ggplot2_demographic_pyramid.png\"\nformat:\n  html:\n    code-fold: false\n    toc: true\n    fig-width: 8\n    fig-height: 6\nexecute:\n  warning: false\n  message: false\n---\n\n\n\n# Introduction to Demographic Pyramids\n\nA **demographic pyramid** is a graphical representation of the age and gender distribution of a population. It typically shows the population in horizontal bars, with males represented on the left and females on the right. Each bar represents a specific age group, and the length of the bar indicates the number of people in that group.\n\nDemographic pyramids are widely used in demographic analysis to visualize the structure of a population, providing valuable insights into trends like population growth, aging, and gender distribution.\n\nThese pyramids are crucial for understanding the socio-economic dynamics of a country, as they highlight the proportions of young versus older populations and reveal patterns related to fertility rates, life expectancy, and migration.\n\nBy analyzing demographic pyramids, policymakers, businesses, and researchers can make informed decisions related to healthcare, education, and workforce planning.\n\n## Required Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(stringr)\nlibrary(showtext)\n\n# Optional for better plotting\nfont_add_google(\"Open Sans\", \"Open Sans\")\nshowtext_auto()\n```\n:::\n\n\n## Sample Data Creation\n\nSince demographic data can be sensitive to access, we'll create realistic sample data that demonstrates the key concepts of demographic pyramid creation:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create sample demographic data for Brazil-like population structure\nset.seed(42)\n\ncreate_demo_data <- function(country, year, pattern = \"young\") {\n  # Age groups\n  age_groups <- c(\"0-4\", \"5-9\", \"10-14\", \"15-19\", \"20-24\", \"25-29\", \"30-34\", \n                  \"35-39\", \"40-44\", \"45-49\", \"50-54\", \"55-59\", \"60-64\", \n                  \"65-69\", \"70-74\", \"75-79\", \"80-84\", \"85+\")\n  \n  # Create different population patterns\n  if (pattern == \"young\") {\n    # Young population - typical developing country\n    base_pop <- c(8.5, 8.2, 7.8, 7.5, 7.0, 6.8, 6.5, 6.2, 5.8, 5.5, \n                  5.0, 4.5, 4.0, 3.5, 2.8, 2.0, 1.2, 0.7)\n  } else if (pattern == \"aging\") {\n    # Aging population - developed country\n    base_pop <- c(4.5, 4.8, 5.2, 5.5, 5.8, 6.2, 6.8, 7.2, 7.5, 7.0,\n                  6.5, 6.2, 5.8, 5.5, 5.0, 4.2, 3.0, 1.8)\n  } else {\n    # Balanced population\n    base_pop <- c(6.5, 6.2, 6.0, 6.5, 7.0, 7.2, 7.0, 6.8, 6.5, 6.0,\n                  5.5, 5.0, 4.5, 4.0, 3.5, 2.5, 1.5, 0.8)\n  }\n  \n  # Add some random variation\n  male_pop <- base_pop + rnorm(length(base_pop), 0, 0.2)\n  female_pop <- base_pop + rnorm(length(base_pop), 0, 0.2)\n  \n  # Ensure positive values\n  male_pop <- pmax(male_pop, 0.1)\n  female_pop <- pmax(female_pop, 0.1)\n  \n  # Create data frame\n  data.frame(\n    country = country,\n    year = year,\n    age_group = rep(age_groups, 2),\n    sex = rep(c(\"Male\", \"Female\"), each = length(age_groups)),\n    population = c(male_pop, female_pop)\n  )\n}\n\n# Create sample data for different countries and years\nbrazil_1990 <- create_demo_data(\"Brazil\", 1990, \"young\")\nbrazil_2020 <- create_demo_data(\"Brazil\", 2020, \"balanced\")\njapan_2020 <- create_demo_data(\"Japan\", 2020, \"aging\")\n\n# Combine data\ndemo_data <- bind_rows(brazil_1990, brazil_2020, japan_2020)\n\n# Process the data for pyramid plotting\ndemo_data <- demo_data |>\n  mutate(\n    sex = factor(sex, levels = c(\"Male\", \"Female\")),\n    age_group = factor(age_group, levels = c(\"0-4\", \"5-9\", \"10-14\", \"15-19\", \"20-24\", \n                                           \"25-29\", \"30-34\", \"35-39\", \"40-44\", \"45-49\", \n                                           \"50-54\", \"55-59\", \"60-64\", \"65-69\", \"70-74\", \n                                           \"75-79\", \"80-84\", \"85+\"))\n  ) |>\n  group_by(country, year) |>\n  mutate(\n    share = population / sum(population) * 100,\n    share = if_else(sex == \"Male\", -share, share)\n  ) |>\n  ungroup()\n```\n:::\n\n\n## Basic Demographic Pyramid\n\nLet's start with a basic population pyramid using Brazil's 1990 demographic data. Each bar shows what percentage of the total population belongs to a specific age group and sex combination.\n\nThe visualization is called a \"pyramid\" because of its distinctive shape: wide at the bottom (many young people), gradually narrowing through the middle ages (fewer adults), and smallest at the top (very few elderly). This triangular shape was typical for most countries in the past and is still common in developing nations today.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter data for Brazil 1990\nbrazil_90 <- demo_data |> \n  filter(country == \"Brazil\", year == 1990)\n\n# Basic pyramid plot\nggplot(brazil_90, aes(x = age_group, y = share)) +\n  geom_col(aes(fill = sex, color = sex)) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  scale_y_continuous(\n    breaks = seq(-8, 8, 2),\n    labels = c(\"8\", \"6\", \"4\", \"2\", \"0\", \"2\", \"4\", \"6\", \"8\")\n  ) +\n  labs(x = \"Age Group\", y = \"Share of Population (%)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n\n## Enhanced Pyramid with Colors and Labels\n\nLet's enhance our pyramid with better colors and explanatory labels. For gender representation, we'll use green for males and purple for females, avoiding traditional stereotypes while ensuring the colors are clearly distinguishable and accessible.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolors <- c(\"#1B9E77\", \"#7570B3\")  # Green for males, purple for females\nfont <- \"Open Sans\"\n\nggplot(brazil_90, aes(x = age_group, y = share)) +\n  geom_col(aes(fill = sex, color = sex)) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  geom_hline(yintercept = 0, color = \"black\", linewidth = 0.5) +\n  annotate(\n    \"text\",\n    x = 16,\n    y = -6,\n    label = \"Male\",\n    color = colors[1],\n    family = font,\n    size = 4,\n    fontface = \"bold\"\n  ) +\n  annotate(\n    \"text\",\n    x = 16,\n    y = 6,\n    label = \"Female\",\n    color = colors[2],\n    family = font,\n    size = 4,\n    fontface = \"bold\"\n  ) +\n  scale_y_continuous(\n    breaks = seq(-8, 8, 2),\n    labels = c(\"8\", \"6\", \"4\", \"2\", \"0\", \"2\", \"4\", \"6\", \"8\")\n  ) +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  labs(\n    title = \"Brazil Population Pyramid - 1990\",\n    x = \"Age Group\", \n    y = \"Share of Population (%)\"\n  ) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2, color = \"grey70\"),\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\n## Temporal Comparison\n\nOne of the most powerful uses of demographic pyramids is to show how population structure changes over time. Let's compare Brazil in 1990 versus 2020:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare Brazil across time periods\nbrazil_comparison <- demo_data |> \n  filter(country == \"Brazil\")\n\nggplot(brazil_comparison, aes(x = age_group, y = share)) +\n  geom_col(aes(fill = sex, color = sex)) +\n  coord_flip() +\n  facet_wrap(~ year, labeller = label_both) +\n  guides(fill = \"none\", color = \"none\") +\n  geom_hline(yintercept = 0, color = \"black\", linewidth = 0.3) +\n  scale_y_continuous(\n    breaks = seq(-8, 8, 4),\n    labels = c(\"8\", \"4\", \"0\", \"4\", \"8\")\n  ) +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  labs(\n    title = \"Brazil's Demographic Transition: 1990 vs 2020\",\n    x = \"Age Group\", \n    y = \"Share of Population (%)\",\n    caption = \"Note the shift from a young population (pyramid shape) to a more balanced structure\"\n  ) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2, color = \"grey80\"),\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    strip.text = element_text(size = 12, face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n\n## Cross-Country Comparison\n\nLet's compare different countries to see how demographic structures vary. We'll compare Brazil (balanced) with Japan (aging population):\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare different countries in 2020\ncountry_comparison <- demo_data |> \n  filter(year == 2020)\n\nggplot(country_comparison, aes(x = age_group, y = share)) +\n  geom_col(aes(fill = sex, color = sex)) +\n  coord_flip() +\n  facet_wrap(~ country) +\n  guides(fill = \"none\", color = \"none\") +\n  geom_hline(yintercept = 0, color = \"black\", linewidth = 0.3) +\n  scale_y_continuous(\n    breaks = seq(-8, 8, 4),\n    labels = c(\"8\", \"4\", \"0\", \"4\", \"8\")\n  ) +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  labs(\n    title = \"Population Structure Comparison: 2020\",\n    x = \"Age Group\", \n    y = \"Share of Population (%)\",\n    caption = \"Brazil shows a balanced structure while Japan displays an aging population pattern\"\n  ) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2, color = \"grey80\"),\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    strip.text = element_text(size = 12, face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=768}\n:::\n:::\n\n\n## Overlay Comparison\n\nFor a more direct comparison between time periods, we can overlay different years using lines and bars:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbrazil_overlay <- demo_data |> \n  filter(country == \"Brazil\")\n\nbreaks_share <- seq(-8, 8, 2)\nlabels_share <- c(\"8\", \"6\", \"4\", \"2\", \"0\", \"2\", \"4\", \"6\", \"8\")\n\nggplot() +\n  geom_col(\n    data = filter(brazil_overlay, year == 2020),\n    aes(age_group, share, fill = sex, color = sex),\n    alpha = 0.8\n  ) +\n  geom_step(\n    data = filter(brazil_overlay, year == 1990),\n    aes(age_group, share, group = sex),\n    color = \"black\",\n    alpha = 0.9,\n    linewidth = 1\n  ) +\n  coord_flip() +\n  guides(fill = \"none\", color = \"none\") +\n  scale_y_continuous(\n    breaks = breaks_share,\n    labels = labels_share\n  ) +\n  labs(\n    title = \"Brazil's Demographic Evolution: 1990 â†’ 2020\",\n    subtitle = \"Black lines show 1990 structure, colored bars show 2020 structure\",\n    x = \"Age Group\", \n    y = \"Share of Population (%)\"\n  ) +\n  scale_color_manual(values = colors) +\n  scale_fill_manual(values = colors) +\n  theme_minimal(base_size = 12, base_family = font) +\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_line(linetype = 2, color = \"grey80\"),\n    plot.title = element_text(hjust = 0.5, size = 14, face = \"bold\"),\n    plot.subtitle = element_text(hjust = 0.5, size = 11)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=768}\n:::\n:::\n\n\n## Working with Brazilian Data Sources\n\nFor real Brazilian demographic data, you can use several official sources:\n\n### IBGE (Brazilian Institute of Geography and Statistics)\n\nThe `{sidrar}` package provides access to IBGE's SIDRA system:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(sidrar)\n\n# Example: Population by age groups and sex\n# Table 6579 - Population estimates by sex and age groups\npopulation_data <- sidrar::get_sidra(\n  api = \"/t/6579/n1/all/v/9324/p/last%201/c2/all/c287/all\"\n)\n```\n:::\n\n\n### Using the geobr Package\n\nThe `{geobr}` package includes some demographic data and can be combined with Census information:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(geobr)\n\n# Population data for municipalities can be combined with geographic data\n# for creating maps with demographic information\nmunicipalities <- read_municipality(year = 2020)\n```\n:::\n\n\n## Key Insights from Demographic Pyramids\n\nWhen analyzing demographic pyramids, look for these key patterns:\n\n1. **Young Population (Pyramid Shape)**: Wide base indicates high birth rates and short life expectancy\n2. **Aging Population (Inverted Pyramid)**: Narrow base with wider top shows declining birth rates and increased longevity\n3. **Stable Population (Barrel Shape)**: Relatively even distribution across age groups\n4. **Population Bulges**: Can indicate baby booms, migration patterns, or historical events\n\n## Summary\n\nDemographic pyramids are powerful tools for visualizing population structure and understanding demographic trends. Key takeaways:\n\n- Use consistent color schemes that avoid gender stereotypes\n- Consider both temporal and cross-country comparisons\n- Overlay techniques can effectively show demographic transitions\n- Brazilian demographic data is available through IBGE via the sidrar package\n- Always provide clear labels and context for your visualizations\n\nThe shift from traditional pyramid shapes to more balanced or even inverted structures reflects global demographic transitions and has important implications for policy planning, economic development, and social services.\n\n---\n\n*Ready to explore more Brazilian data visualizations? Check out our tutorial on [Brazilian Data Sources](../../r-fundamentals/brazilian-data/index.qmd) or learn about [Interactive Maps](../choropleth-maps/index.qmd).*",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}