<!-- Google Analytics 4 Enhanced Configuration -->
<!-- Replace G-XXXXXXXXXX with actual GA4 measurement ID when available -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  // Enhanced configuration for educational platform
  gtag('config', 'G-XXXXXXXXXX', {
    // Enable enhanced ecommerce for course purchases
    'enhanced_ecommerce': true,
    
    // Track course and tutorial engagement
    'custom_map': {
      'custom_parameter_1': 'tutorial_category',
      'custom_parameter_2': 'course_level',
      'custom_parameter_3': 'content_language'
    },
    
    // Optimize for Brazilian audience
    'country': 'BR',
    'currency': 'BRL',
    
    // Privacy-compliant settings
    'anonymize_ip': true,
    'allow_google_signals': false,
    'allow_ad_personalization_signals': false
  });

  // Track language preference
  gtag('event', 'page_view', {
    'content_language': document.documentElement.lang || 'en',
    'content_group1': window.location.pathname.startsWith('/pt/') ? 'Portuguese' : 'English'
  });

  // Enhanced educational event tracking
  gtag('event', 'educational_platform_load', {
    'platform_type': 'quarto_website',
    'educational_focus': 'urban_economics_r_programming'
  });
</script>

<!-- Brazilian Market Analytics Enhancement -->
<script>
// Track Brazilian-specific engagement patterns
(function() {
  // Detect if user is likely from Brazil (timezone-based approximation)
  const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
  const isBrazilianTimezone = timezone.includes('America/Sao_Paulo') || 
                             timezone.includes('America/Fortaleza') || 
                             timezone.includes('America/Recife') || 
                             timezone.includes('America/Manaus') ||
                             timezone.includes('America/Rio_Branco');
  
  if (isBrazilianTimezone && typeof gtag !== 'undefined') {
    gtag('event', 'brazilian_timezone_detected', {
      'timezone': timezone,
      'market_focus': 'domestic_brazilian'
    });
  }

  // Track course enrollment funnel
  window.ekioTrackEnrollmentStep = function(step, courseName) {
    if (typeof gtag !== 'undefined') {
      gtag('event', 'enrollment_step', {
        'step': step,
        'course_name': courseName,
        'currency': 'BRL'
      });
    }
  };

  // Track tutorial completion
  window.ekioTrackTutorialComplete = function(tutorialName, timeSpent) {
    if (typeof gtag !== 'undefined') {
      gtag('event', 'tutorial_complete', {
        'tutorial_name': tutorialName,
        'engagement_time_msec': timeSpent,
        'content_group': 'tutorial_completion'
      });
    }
  };

  // Track R code execution (for interactive tutorials)
  window.ekioTrackCodeExecution = function(codeType, tutorialName) {
    if (typeof gtag !== 'undefined') {
      gtag('event', 'code_execution', {
        'code_type': codeType,
        'tutorial_name': tutorialName,
        'interaction_type': 'hands_on_learning'
      });
    }
  };

  // Track external link clicks to EKIO main site
  document.addEventListener('click', function(e) {
    const link = e.target.closest('a');
    if (link && link.href && link.href.includes('ekio.com.br')) {
      if (typeof gtag !== 'undefined') {
        gtag('event', 'click', {
          'event_category': 'outbound',
          'event_label': 'ekio_main_site',
          'transport_type': 'beacon',
          'custom_parameter_1': 'lead_generation'
        });
      }
    }
  });
})();
</script>

<!-- Performance Monitoring for Brazilian Users -->
<script>
// Monitor site performance specifically for Brazilian users
(function() {
  // Track page load time for educational content optimization
  window.addEventListener('load', function() {
    if (typeof gtag !== 'undefined') {
      gtag('event', 'timing_complete', {
        'name': 'page_load',
        'value': Math.round(performance.now())
      });
    }
  });

  // Track R code block rendering performance (important for tutorials)
  const codeBlocks = document.querySelectorAll('pre code');
  if (codeBlocks.length > 0 && typeof gtag !== 'undefined') {
    gtag('event', 'code_blocks_rendered', {
      'code_block_count': codeBlocks.length,
      'content_type': 'educational_r_code'
    });
  }
})();
</script>

<!-- Conversion Tracking for Course Enrollments -->
<script>
// Enhanced conversion tracking for educational platform
window.ekioTrackConversion = function(conversionType, value, currency = 'BRL') {
  if (typeof gtag !== 'undefined') {
    gtag('event', 'purchase', {
      'transaction_id': 'academy_' + Date.now(),
      'value': value,
      'currency': currency,
      'items': [{
        'item_id': conversionType,
        'item_name': conversionType.replace('_', ' '),
        'category': 'education',
        'quantity': 1,
        'price': value
      }]
    });
  }
};

// Track high-value educational interactions
window.ekioTrackEducationalEngagement = function(engagementType, details) {
  if (typeof gtag !== 'undefined') {
    gtag('event', 'educational_engagement', {
      'engagement_type': engagementType,
      'engagement_details': details,
      'platform': 'ekio_academy',
      'market': 'brazil'
    });
  }
};
</script>